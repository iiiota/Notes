official：https://www.rfc-editor.org/rfc/rfc793

[toc]

TRANSMISSION CONTROL PROTOCOL

### Preface

文档描述了DoD美国国防部标准的TCp协议。基于已存在的9个版本的ARPA TCP规范。这个版本澄清了几个细节。



### 1. Introduction

TCP旨在作为包交换计算机通信网络中主机间的高可靠性的host-to-host协议，以及此类网络的互连系统。本文描述了TCP要执行的功能、实现程序、以及程序接口。



#### 1.1 Motivation

计算机通信系统在军方、政府机构、民用环境中扮演越来越重要的角色。本文档主要聚焦于军用计算机需求，特别是通信不可靠情况下的健壮性和通信拥塞时的可用性，但许多问题也存在于民用和政府部门。

随着通信网络的发展和部署，提供连接它们的方法和支持广泛应用程序的标准进程间通信协议是至关重要的。本文所描述的TCP将成为美国国防部范围内进程间通信协议标准化的基础。

TCP是面向连接的、end-to-end的可靠协议，旨在适应支持多网络应用的协议分层结构。TCP提供计算机通信网络中的主机进程对之间的可到进程间通信。很少对TCP层一下的通信协议的可靠性做假设。TCP假定它可以从低级协议获得简单的、可能不可靠的数据报服务。原则上，TCP应该能够在从硬连线连接到分组交换或电路交换网络的广泛通信系统上运行。

TCP适用于在基本IP协议之上的分层协议体系结构。为TCP提供了一种方式来发送和接收包含在互联网数据报“信封”中的可变长度信息段。IP数据报提供了在不同网络中源/目标TCP寻址的方式。IP协议也处理了通过多个网络和互连网关实现传输交互所需的TCP segments段的分配/重组。IP协议还携带有关TCP段的优先级、安全分类和划分的信息。因此，这些信息可以跨多个网络进行端到端通信。

```
Protocol Layering
+---------------------+
|     higher-level    |
+---------------------+
|        TCP          |
+---------------------+
|  internet protocol  |
+---------------------+
|communication network|
+---------------------+
```



#### 1.2 Scope

TCP旨在在多网络环境中提供可靠的进程间通信服务。TCP旨在成为在多个网络中普遍使用的主机对主机协议。



#### 1.3 About this Document

本文档表示任何TCP实现所需的行为规范，包括与更高级别协议的交互以及与其他TCP的交互。提供了非常简短的协议接口和操作的视图，总结了TCP设计的哲学基础，提供了TCP在各种事件发生时所需操作的详细描述（新segment到达、用户调用、错误等）和TCP segment的格式细节。



#### 1.4 Interfaces

TCP接口的一端是用户或应用程序进程，另一端是较低级别的协议，如IP协议。应用程序进程和TCP之间的接口给出了合理的详细说明。该接口由一组调用组成，非常类似于操作系统为操作文件而向应用程序进程提供的调用。比如，打开/关闭连接的调用、已建立连接状态下发送/接收数据的调用。同时也期望TCP能够与应用程序进行异步通信。尽管TCP实现者被允许有相当大的自由来设计适合于特定操作系统环境的接口，任何有效的实现都需要TCP/用户接口上的最小功能。

TCP和低级协议之间的接口基本上是未指定的，除非假设存在一种机制，使两个级别可以异步地相互传递信息。通常期望较低级协议指定此接口。TCP被设计为在非常通用的互联网络环境中工作。本文档假定底层协议为IP协议。



#### 1.5 Operation

TCP主要目的是在进程对间提供可靠安全的连接服务。在不太可靠的互联网通讯系统上提供这项服务，需要下列设施:

- Basic Data Transfer 基本数据传输
- Reliability 可靠性
- Flow Control 流量控制
- Multiplexing 多路复用
- Connections 连接
- Precedence and Security 优先级和安全



Basic Data Transfer：

TCP能够在用户间通过打包一些字节到segment来传输连续的字节流，通常TCP根据自己的方便决定何时block阻塞和forward转发数据。有时用户需要确保他们提交给TCP的所有数据都已传输，为此定义了一个push功能。为了确保提交给TCP的数据被实际传输，发送用户指示它应该被推送到接收用户。

Reliability：

TCP必须从被互联网通信系统损坏、丢失、重复或传送无序的数据中恢复。这是通过给每个传输的字节分配一个序列号来实现的，并且接收TCP的积极确认ACK。若在超时间隔中没有收到ACK，数据将重新发送。在接收端，序列号用于对可能接收到的无序片段纠正segment顺序，并消除重复segment。损坏是通过添加校验和并在接收端进行检查来处理的。

只要tcp继续正常工作，没有任何传输错误会影响数据的正确传递，TCP可从错误中恢复过来。

Flow Control:

TCP为Receiver提供了一种控制Sender发送的数据量的方法。这是通过返回一个“窗口”来实现的，其中每个ACK都指示成功接收到的最后一个segment之外的可接受序列号范围。该窗口指示Sender在收到进一步许可之前可以传输的允许字节数。

Multiplexing：

为了单个主机中多个进程同时使用TCP通信功能，TCP在每个主机中提供了一组地址或端口。与来自互联网通信层的网络和主机地址连接，形成一个Socket。Socket对唯一标识了每个连接。也就是说一个Socket可同时用于多个连接。

端口到进程的绑定由每个主机独立处理。然而，事实证明将经常使用的进程(例如，“logger”或分时服务)附加到固定的套接字上是有用的，这些套接字对公众是已知的，然后可以通过已知地址访问这些服务。建立和了解其他进程的端口地址可能涉及更动态的机制。

Connections：

上面描述的可靠性和流量控制机制要求TCP初始化并维护每个数据流的某些状态信息。这些信息（包括Socket、序列号和窗口大小）的组合称为连接。每个连接都由一对标识其两端的Socket唯一指定。

当两进程希望通信时，各自的TCP必须首先建立连接（初始化状态信息）。通信完成时，连接会被终止或关闭来释放各自使用的资源。

因为连接必须要在不可靠的互联网通信系统上的不可靠主机间建立。基于时钟的序列号的handshake握手机制用于避免连接初始化错误。

Precedence and Security：

TCP用户可能会标记通信的安全和优先级。规定了在不需要这些特性时使用的默认值。



### 2. Philosophy



#### 2.1  Elements of the Internetwork System











